> Проанализировать схемы севооборота и предсказать объёмы посевных культур.

# **Описание кейса**

Фермеры и агрохолдинги стремятся увеличивать доход, повышая урожайность и снижая издержки. Для этого применяется севооборот — поочерёдное выращивание различных культур. Например, сначала сеют озимую рожь, на следующий год — картофель, потом яровую пшеницу, а после неё клевер. Это помогает бороться с сорняками и поддерживать плодородность почвы, обогащая её питательными веществами. Чередуя культуры в определённом порядке, фермеры экономят на удобрениях и пестицидах.

Зная стратегии севооборота, которые применяют фермеры, можно предсказать, как будут изменяться характеристики почвы и урожайность. Это позволяет прогнозировать объём произведённых продуктов в масштабе регионов и государств, а также изменение цен на международном рынке сельхозпродукции.

Участникам необходимо:

- проанализировать набор данных,
- выявить последовательность смены посевных культур на заданных полях за десять лет,
- предсказать, какую культуру там сеяли в 2020.

Набор данных собран из открытой статистики о посевах во Франции за 2010–2019 год. Предсказание необходимо сделать для 100 полей в регионе Haute-de-France, а также в рандомизированной выборке из 100 000 полей для 2019 года. Этой выборки не будет в представленном наборе данных.

# **Требуемые результаты**

*Для каждой точки Point() вывести прогнозируемую культуру посева на указанный год в файле predict.csv*

# **Дополнительные сведения**

**Ограничения схемы севооборота** — одну и ту же культуру не сеют два года подряд. Исключения: виноградники, лесные хозяйства и луга, а в некоторых регионах кукуруза.

**Схемы севооборота** можно разделить на 3 группы:

Короткую — 2–3 года

Среднюю — 3–6 лет

Долгосрочную 6–10 лет

Когда цикл завершается, последовательность культур повторяют.

Короткий цикл применяют для более прибыльных культур, он сильнее истощает почву. Средние и длительные истощают почву меньше.

**Специфика климата** влияет на предпочтительный выбор посевных культур. На севере и юге или востоке и западе выращивают разное.

**Координаты центра поля** приведены в формате WKT в проекции Lambert-93 ([ESPG:2154](https://epsg.io/2154)), единица координат — 1 метр.

**Источник данных** — [открытая статистика о посевах во Франции](https://www.data.gouv.fr/en/datasets/registre-parcellaire-graphique-rpg-contours-des-parcelles-et-ilots-culturaux-et-leur-groupe-de-cultures-majoritaire/).

# **Метрика**

Процент корректно предсказанных культур для заданных полей (accuracy).

# **Данные**

- Данные о культивируемом посеве с привязкой к центру поля за 2015–2019 года. За год собирается около 9,5 млн записей.
- Данные об основной культивируемой группе культур с привязкой к центру участка за 2010–2014 года. За год собирается около 6 млн записей.

Справка. Участок — непрерывный кусок земли, принадлежащий фермеру. На этой земле фермер выращивает одну или несколько культур, по-разному разбивая участок каждый год.

- Список культур и их принадлежность к группе.

Данные представлены по ссылке на Kaggle:

[DVHB_hackathon](https://www.kaggle.com/denisthemartyr/dvhb-hackathon)


# Ход решения
## Гипотезы
1. Существует возможность выделить кластеры, содержащие ограниченное (не сотни, а хотя бы десятки) количество культур.
2. Для каждого из таких кластеров возможно создать и обучить модель, которая предскажет, какие культуры будут засеяны на полях кластера в следующем году.
3. Список признаков можно обогатить дополнительными данными, в том числе сведениями об административном делении территории Франции, климатических зонах и т. п.
4. На части полей регулярно сеется одна и та же культура, ее предсказание тривиально.
5. Существует возможновть добиться точности (accuracy) предсказаний > 80 %.

## 1. Кластеризация
Рассматриались следующие принципы кластеризации:
1.1. Географический.<br>
1.2. На основе разреженных векторов состава засеваемых культур.<br>
1.3. На основе групп засеваемых культур.<br>
1.4. Комбинированный.

<p align="left">
  <img src="https://user-images.githubusercontent.com/11871192/111023406-f373c000-83e9-11eb-9f44-3fa3f1da8ef0.png" width="350" title="Посевы">
  <img src="https://user-images.githubusercontent.com/11871192/111023407-f4a4ed00-83e9-11eb-9dd2-ee4ce716ee7c.png" width="350" title="География">
</p>

Отмечена довольно слабая (если не сказать никакая) корреляция между кластерами на основе векторов культур и географическими кластерами.<br>
В качестве основного был выбран принцип кластеризации на основе разреженных векторов состава засеваемых культур. При кластеризации по этому принципу было выделено большое число кластеров, содержащих одну или две культуры.

![clusters_vs_cultures](https://user-images.githubusercontent.com/11871192/111024451-e6f26600-83ef-11eb-971a-96b15e487836.png)

Географические кластеры используются как признаки при классификации.

## 2. Классификация

В качестве классификатора был выбран LightGBM - алгоритм градиентного бустинга, разработанный компанией Microsoft.<br>
Он сравнительно быстрый и не слишком требовательный к ресурсам - то, что нужно для data science в домашних условиях.<br>
Модели обучались и тестировались для каждого кластера в отдельности.<br>
Наиболее значимым признаком оказался признак географического кластера.<br>

![features](https://user-images.githubusercontent.com/11871192/111024436-d9d57700-83ef-11eb-811f-cc7d391f15ce.png)

## 3. Результаты

При обучении модели на данных за 2015-2017 годы с целью предсказания посевов на 2018 год и при валидации на тестовых данных из папки test_2019 достигнуто значение метрики **accuracy 0.8588**.<br>

При обучении модели на данных за 2015-2018 годы с целью предсказания посевов на 2019 год и при валидации на тестовых данных из папки test_2020 достигнуто значение метрики **accuracy 0.8148**.

Созданы файлы предсказаний в соответствии с поставленной задачей - **predict2019.csv** и **predict2020.csv**.

## 4. Проблемы
4.1. Время.<br>
Время на решение задачи ограничено продолжительностью хакатона. Часть гипотез не удалось проверить, так как основные этапы процесса (преимущественно сбор и обработка данных) занимают больше времени, чем отпущено.

4.2. Вычислительные мощности.<br>
Тот случай, когда данных оказалось слишком много: Google Colab падает без памяти, домашние компьютеры кипят и виснут. Некоторые идеи оказалось физически невозможно реализовать из-за недостатка вычислительных мощностей, имеющихся в распоряжении команды. Некоторые по той же причине стали занимать непозволительно много времени, далее см. п. 4.1.

4.3. Компетенции.<br>
Есть вещи, которые мы хотели бы сделать, но не знаем как. Мы ведь пока еще не настоящие сварщики. Мы обязательно научимся, но это займет некоторое время, далее см. п. 4.1.

## 5. А у нас еще столько идеек было!
Краткий обзор того, что хотели бы сделать, но не смогли по причинам из раздела 4.

5.1. Кластеризация по границам департаментов (координаты -> Reverse Geocoding -> географические кластеры). Не исключено, что исторически административное деление Франции происходило, в том числе, и с учетом сельскохозяйственных соображений.<br>
5.2. Кластеризация по климатическим зонам.<br>
5.3. Кластеризация по десятилетним последовательностях групп культур с учетом цикличности.<br>
5.4. Ансамбли классификаторов.
